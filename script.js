const questions = {
    "Как называется чертеж земной поверхности?": {
        "true_answer": 0,
        "answers": ["Карта", "Схема", "Условные знаки"],
        "score": 5,
        "img": "https://u.foxford.ngcdn.ru/uploads/tinymce_file/file/14205/e0a803ccccb8dc18.png"
    },
    "Выберите территорию, реки которой наиболее подходят для строительства ГЭС": {
        "true_answer": 0,
        "answers": ["Юг Восточной Сибири", "Уральские горы", "Западно-Сибирская равнина"],
        "score": 5,
        "img": "https://s9.travelask.ru/system/images/files/001/502/969/wysiwyg_jpg/FCF11D52-187B-42D6-A5A2-25C680C589FD.jpg?1637931559"
    },
    "Что является причиной возникновения цунами?": {
        "true_answer": 0,
        "answers": ["Моретрясение", "Извержение вулканов", "Океанский ветер"],
        "score": 5,
        "img": "https://waterservice.kz/blog/img/art110-1.jpg"
    },
     "Крупнейшим хранилищем запасов пресных вод в России": {
        "true_answer": 0,
        "answers": ["Озера, пруды и водохранилища", "Моря", "Реки"],
        "score": 5,
        "img": "https://natworld.info/wp-content/uploads/2020/05/vodohranilishhe-plotina.jpg"
    },
    "Выберите вариант, где неверно указаны причинно-следственные связи": {
        "true_answer": 1,
        "answers": ["Создание полезащитных лесополос — уменьшает почвенную эрозию", "Орошение почв — предотвращает засоление земель", "Снегозадержание — увеличивает содержание влаги в почве"],
        "score": 5,
        "img": "https://gruntovozov.ru/wp-content/uploads/Zasolennyie-pochvyi/Zasolennyie-pochvyi_(34).jpg"
    },
    "Кто является первым создателем географической карты?": {
        "true_answer": 0,
        "answers": ["Эратосфен", "Аренст", "Героклит"],
        "score": 5,
        "img": "https://www.pnp.ru/upload/entities/2021/09/28/15/article/detailPicture/34/6a/ba/b6/3dddea75d60e01ebfea83b88eac9df64.jpg"
    },
    "Какие течения относятся к холодным?": {
        "true_answer": 2,
        "answers": ["Аляскинское и Гольфстрим", "Гвианское и Калифорнийское", "Калифорнийское и Перуанское"],
        "score": 5,
        "img": "https://assets-global.website-files.com/599873abab717100012c91ea/5fa147823ed7903feb284a5d_%D1%82%D0%B5%D1%87%D0%B5%D0%BD%D0%B8%D1%8F_2%20(1)%20(1)%20(1)%20(1)%20(1)%20(1).png"
    },
    "Что является причиной возникновения цунами?": {
        "true_answer": 0,
        "answers": ["Моретрясение", "Извержение вулканов", "Океанский ветер"],
        "score": 5,
        "img": "https://waterservice.kz/blog/img/art110-1.jpg"
    },
    "Укажите пограничное озеро России": {
        "true_answer": 2,
        "answers": ["Байкал", "Чаны", "Каспийское"],
        "score": 5,
        "img": "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1b/Caspian_Sea_from_orbit-NoRedLines.jpg/280px-Caspian_Sea_from_orbit-NoRedLines.jpg"
    },
    "Сколько составляет площадь поверхности всей Земли?": {
        "true_answer": 0,
        "answers": ["510.2 млн. кв. км.", "423.2 млн. кв.км.", "20.3 млн. кв. км."],
        "score": 5,
        "img": "https://upload.wikimedia.org/wikipedia/commons/0/0d/Africa_and_Europe_from_a_Million_Miles_Away.png"
    },
     "Какова в России средняя продолжительность жизни мужчин? (по оценке ВОЗ 2019 года)": {
        "true_answer": 2,
        "answers": ["62.1", "57.9", "60.7"],
        "score": 5,
        "img": "https://visasam.ru/wp-content/uploads/2017/10/5410-6-eksperty_vsemirnogo_ban_ru-450x333.jpg"
    },
    "Какова в России средняя продолжительность жизни женщин? (по оценке ВОЗ 2019 года)": {
        "true_answer": 1,
        "answers": ["59.8", "67.5", "62.4"],
        "score": 5,
        "img": "https://www.renlife.ru/upload/medialibrary/18a/middle-age-white-hair-woman-holding-a-sandglass-timer_1194-334309.jpg"
    },
    "Какое место в мире по численности населения занимает Россия?": {
        "true_answer": 0,
        "answers": ["8", "18", "10"],
        "score": 5,
        "img": "https://www.oka.fm/afisha/4563546745745676613.png"
    },
    "С какой страной проходит самая короткая граница россии?": {
        "true_answer": 1,
        "answers": ["С Эстонией", "С КНДР", "С Южной Осетией"],
        "score": 5,
        "img": "https://s9.travelask.ru/system/images/files/001/190/875/wysiwyg_jpg/f005.jpg?1536941628"
    },
    "Мыс Флигели расположен на острове?": {
        "true_answer": 0,
        "answers": ["Рудольфа", "Врангеля", "Ратманова"],
        "score": 5,
        "img": "https://img.geliophoto.com/fligely/00_fligely.jpg"
    },
    "На сколько часовых поясов поделена Россия?": {
        "true_answer": 2,
        "answers": ["10", "9", "11"],
        "score": 5,
        "img": "https://reader.lecta.rosuchebnik.ru/demo/8030/data/images/autogen_41732.jpg"
    },
    "Самая высокая точка России?": {
        "true_answer": 0,
        "answers": ["Гора Эльбрус", "Гора Казбек", "Гора Белуха"],
        "score": 5,
        "img": "https://www.erv.ru/upload/iblock/ca5/1.jpg"
    },
    "Какая эра является самой древней?": {
        "true_answer": 1,
        "answers": ["Архейская", "Палеозойская", "Мезозойская"],
        "score": 5,
        "img": "https://ykl-res.azureedge.net/dae41c9d-e624-4b77-9a5a-f5c98330aa8c/shutterstock759826384w400.png"
    },
    "Кто был автором теории литосферных плит?": {
        "true_answer": 1,
        "answers": ["М. Фернан", "А. Вегенер", "Д. Кук"],
        "score": 5,
        "img": "https://u.foxford.ngcdn.ru/uploads/tinymce_image/image/75975/35dc9fb8e97db489.png"
    },
     "Сколько морей омывает территорию России?": {
        "true_answer": 0,
        "answers": ["15", "18", "12"],
        "score": 5,
        "img": "https://s9.travelask.ru/system/images/files/001/190/875/wysiwyg_jpg/f005.jpg?1536941628"
    }
}

const error = `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" version="1.1" viewBox="0 0 32 32">
    <g transform="scale(2)">
    <circle style="fill:#f44336" cx="8" cy="8" r="7"/>
    <rect style="fill:#ffffff" width="2" height="10" x="-.98" y="-16.29" transform="rotate(135)"/>
    <rect style="fill:#ffffff" width="2" height="10" x="-12.29" y="-5.01" transform="rotate(-135)"/>
    </g>
    </svg>`;
const ok = `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" version="1.1" viewBox="0 0 32 32">
    <g transform="scale(2)">
    <circle style="fill:#4caf50" cx="8" cy="8" r="7"/>
    <path style="fill:#ffffff" d="M 11.535,4.4 7.2928,8.6 4.4647,5.8 3.0506,7.2 5.8787,10.1 7.2928,11.5 12.949,5.8 Z"/>
    </g>
    </svg>`;


let index = 0;

function end_test() {
    let score = 0;
    let max_score = 0;
    for (let key in questions) {
        max_score += questions[key]["score"]
    }

    let results = '';
    $('.question').each(function () {
        let icon = error;
        let val = $(this).find('input:checked').val();
        let i = $('.question').index(this);
        let key = Object.keys(questions)[i];
        let this_score = questions[key]["score"];

        if (val) {
            val = parseInt(val);

            if (questions[key]["true_answer"] === val) {
                score += this_score
                icon = ok;
            }
        }
        results += `<div class="result">
            <div>
                <span class="result-text ${icon === ok ? 'ok' : 'error'}">${key}</span>
                <span>${this_score} баллов</span>
            </div>
            <div class="icon">
                ${icon}
            </div>
        </div>`;
    });

    $('#test').html(`
    <div class="question">
        <div class="question-title">
                <span class="question-title-text">
                    Ваш результат ${score}/${max_score}!
                </span>
        </div>
        <div class="results">
            ${results}
        </div>
        <div class="navigation">
            <div class="total-result">${score}/${max_score}</div>
            <div class="btn reload" onclick="location.reload()">Ещё раз</div>
        </div>
    </div>`);
}

function get_answer(answer, i) {
    let questions = document.querySelectorAll('.question')
    let count = questions.length;
    return `
    <div class="answer">
        <label>
            <input class="answer-input" type="radio" value="${i}" name="radio-${count}">
            <span class="answer-text">${answer}</span>
        </label>
    </div>`;
}

function get_question(question, answers) {
    let answers_element = '';
    for (let i in answers) {
        let answer = answers[i];
        answers_element += get_answer(answer, i);
    }
    return `
    <div class="question">
        <div class="question-title">
                <span class="question-title-text">
                    ${question}
                </span>
        </div>
        <div class="question-inner row">
            <div class="answers col-12 col-md-6">
                ${answers_element}
            </div>
            <img class="question-img col-12 col-md-6" src="${questions[question]['img']}" alt="">
        </div>
        <div class="navigation">
            <div class="btn prev" onclick="prev_question()"><</div>
            <div class="btn next" onclick="next_question()">></div>
        </div>  
    </div>`;
}

function add_question(question, answers) {
    let element = get_question(question, answers);
    let test = document.querySelector('#test');
    test.innerHTML += element;
}

function display_questions(i) {
    $('.question').fadeOut(400);
    setTimeout(function () {
        $('.question').eq(i).fadeIn();
        if (i === 0) {
            $('.prev').hide();
            $('.navigation').css('justify-content', 'flex-end');
        } else {
            $('.prev').show();
            $('.navigation').css('justify-content', 'space-between');
        }
        if (i === $('.question').length - 1) {
            $('.next').text('Завершить').attr("onclick", "end_test()").addClass('final');
        } else {
            $('.next').text('>').attr("onclick", "next_question()").removeClass('final');
        }

    }, 400);
}

function next_question() {
    if (index + 1 < $('.question').length) {
        index += 1;
        display_questions(index);
    }
}

function prev_question() {
    if (index - 1 >= 0) {
        index -= 1;
        display_questions(index);
    }
}

function create_test() {
    for (let question in questions) {
        let answers = questions[question]['answers'];
        add_question(question, answers);
    }
    $('.question').hide();
    display_questions(0);
}

create_test();
